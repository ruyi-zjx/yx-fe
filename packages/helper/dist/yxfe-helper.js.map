{"version":3,"file":"yxfe-helper.js","sources":["../src/get-page-setting.ts","../src/directives/visible.ts"],"sourcesContent":["import { Route } from 'vue-router'\nconst { pathToRegexp } = require('path-to-regexp')\n\n/**\n * 获取目标页面的动态配置\n * @param {*} route 页面的路由\n * @param {*} pages 所有的页面配置\n */\nexport default function getPageSetting(route: Route, pages?: DynamicSetting['pages']): PageSetting | undefined {\n  let curSetting\n  if (!pages) return curSetting\n  for (let i = 0, len = pages.length; i < len; i++) {\n    const cur = pages[i]\n    const regex = pathToRegexp(cur.path)\n    // 使用正则进行匹配，找出该页面的相关配置\n    if (regex.exec(route.path)) {\n      curSetting = cur\n      break\n    }\n  }\n  return curSetting\n}\n","import { VNode } from 'vue'\nimport { DirectiveBinding } from 'vue/types/options'\nimport { IVHandlers, IVVisibleYx } from '../../types/visible'\nimport getPageSetting from '../get-page-setting'\n\nconst DIRE = `[ visible-yx ] `\n\nconst VVisible: IVVisibleYx = {\n  // 动态设置\n  dynamicSetting: undefined,\n\n  install: function (Vue, options) {\n    if (!options?.store) return console.error(DIRE + '指令注册失败：注册指令必须传入`vuex`实例')\n    const dynamicSetting = options.store.state[options.dynamicStoreKey || 'dynamicSetting']\n    if (!dynamicSetting) return console.error(DIRE + '指令注册失败：未发现存储动态配置的`module`.')\n    this.dynamicSetting = dynamicSetting\n    Vue.directive('visible-yx', {\n      inserted: this.inserted.bind(this),\n    })\n  },\n\n  inserted: function (el, binding, vnode) {\n    // 页面元素名\n    const elementName = binding.arg\n    if (!elementName) return\n    // 当前页面的路由\n    const route = vnode.context.$route\n    // 当前页面数据\n    const setting = getPageSetting(route, this.dynamicSetting?.pages)\n    // 当前页面无配置？直接退出\n    if (!setting) return\n    // 从修饰符中获取当前组件类型\n    const component = Object.keys(binding.modifiers)[0] || 'default'\n    // 预置好的组件处理函数\n    const presetCompHandler: IVHandlers = {\n      table: handleTable,\n    }\n    const compHandlers = Object.keys(presetCompHandler)\n    if (component === 'default') {\n      handleDefault(setting, elementName, el, binding, vnode)\n    } else if (component in compHandlers) {\n      const compSetting = setting[component]\n      if (!compSetting) return\n      // 因为一个页面可能有多个相同的组件，所以这边继续拿指定元素名的组件配置\n      const eleSetting = compSetting[elementName] as TableSetting\n      if (!eleSetting || !Object.keys(eleSetting).length) return\n      const handler = presetCompHandler[component]\n      handler(eleSetting, elementName, el, binding, vnode)\n    } else {\n      console.warn(`${DIRE} 未发现\\`${component}\\`组件类型的处理函数，请检查\\`${binding.rawName}\\`指令语法是否正确`)\n    }\n  },\n}\n\n// 处理一般的元素，单纯控制元素是否显示或者隐藏\nfunction handleDefault(\n  setting: PageSetting,\n  elementName: string,\n  el: HTMLElement,\n  binding: DirectiveBinding,\n  vnode: VNode\n) {\n  const { visible = [] } = setting\n  if (!visible.includes(elementName)) {\n    ;(el.parentNode && el.parentNode.removeChild(el)) || (el.style.display = 'none')\n  }\n}\n\nfunction handleTable(\n  setting: TableSetting,\n  elementName: string,\n  el: HTMLElement,\n  binding: DirectiveBinding,\n  vnode: VNode\n) {\n  const vm = vnode.componentInstance\n  const { columns = [], scroll = {}, visible = true } = setting\n  if (!visible) {\n    ;(el.parentNode && el.parentNode.removeChild(el)) || (el.style.display = 'none')\n  }\n  // 1. 处理需要显示的列\n  if (columns.length) {\n    const fullColumns = vm?.columns || []\n    for (let i = fullColumns.length - 1; i >= 0; i--) {\n      const target = fullColumns[i]\n      if (!columns.includes(target.dataIndex || target.key)) {\n        fullColumns.splice(i, 1)\n      }\n    }\n  }\n  // 2. 处理横向或纵向滚动距离\n  Object.assign(vm?.scroll, scroll)\n}\n\nexport default VVisible\n"],"names":[],"mappings":"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"}